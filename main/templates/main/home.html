{% extends 'base.html' %}
{% load static %}

{% block title %}Anasayfa - Eğitim Programları{% endblock %}

{% block content %}

    {# Sadece program yoksa gösterilecek hoş geldiniz mesajı #}
    {% if not programs and not all_courses %}
        <div class="container" style="text-align: center; padding: 50px;">
            <h1>Hoş Geldiniz!</h1>
            <p>Şu anda gösterilecek aktif bir eğitim programı veya kurs bulunmamaktadır. Lütfen daha sonra tekrar kontrol ediniz.</p>
        </div>
    {% endif %}

    {# === TÜM KURSLARIN LİSTELENDİĞİ BÖLÜM (En Üstte) === #}
    {% if all_courses %}
    <div class="course-list-container">
        <h2>Tüm Kurslarımız</h2> {# Genel kurs başlığı #}
        <table class="course-table">
            <thead>
                <tr>
                    <th>Yer / Saat</th>
                    <th>Sınıf Aralığı</th>
                    <th>Kontenjan</th>
                    <th>Kayıt</th>
                </tr>
            </thead>
            <tbody>
                {% for course in all_courses %}
                    <tr>
                        <td>{{ course.venue_and_time }}</td>
                        <td>{{ course.grade_range }}</td>
                        <td>{{ course.capacity }}</td>
                        <td>
                            <button class="btn-select btn-open-modal" data-course-id="{{ course.id }}">Seçiniz</button>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %}

    {# Eğer hem kurslar hem de programlar varsa, aralarına bir ayırıcı ekleyelim #}
    {% if all_courses and programs %}<hr style="margin: 40px auto; width: 80%; border-top: 1px solid #eee;">{% endif %}


    {# === HER BİR PROGRAMIN AFİŞ VE DETAYLARININ LİSTELENDİĞİ BÖLÜM (Alt Alta) === #}
    {% if programs %}
        <div class="all-programs-details-section"> {# Tüm programları kapsayan ana div #}
            {% for program in programs %} {# Her bir program için döngü başlat #}

                {# Her program bloğu için kapsayıcı, boşluk ve gölge ekleyebiliriz #}
                <div class="program-block"> 
                    <div class="program-header-info"> {# Afiş ve bilgi kutularını yan yana tutmak için #}
                        <div class="poster-display"> {# Afişi tutan kısım #}
                            {% if program.poster %}
                                <img src="{{ program.poster.url }}" alt="{{ program.title }} Afişi">
                            {% else %}
                                <img src="{% static 'img/varsayilan_program_afisi.jpg' %}" alt="Varsayılan Program Afişi">
                            {% endif %}
                        </div>

                        <div class="program-compact-info"> {# Bilgi kutucuklarını tutan kısım #}
                            <h3>{{ program.title }}</h3> {# Program başlığı #}
                            <div class="info-box-compact"><strong>Konum:</strong> {{ program.location }}</div>
                            <div class="info-box-compact">
                                <strong>Başlangıç / Bitiş:</strong>
                                {{ program.start_date|date:"d M" }} - {{ program.end_date|date:"d M Y" }}
                            </div>
                            <div class="info-box-compact"><strong>Ücret:</strong> {{ program.price }} ₺</div>
                            
                            {# Eğer programın kendine özgü kurslarını burada da göstermek isterseniz (isteğe bağlı) #}
                            {# {% if program.courses.all %}
                            {#     <p>Bu programa ait kurslar:</p>
                            {#     <ul>
                            {#         {% for course in program.courses.all %}
                            {#             <li>{{ course.venue_and_time }} - {{ course.grade_range }}</li>
                            {#         {% endfor %}
                            {#     </ul>
                            {# {% endif %} #}
                        </div>
                    </div> {# .program-header-info kapanışı #}

                    {# Akordiyon Bölümleri (Amaç, Kazanımlar vb.) #}
                    <div class="program-accordion-details"> 
                        {% if program.sections.all %}
                        <h2>Detaylar</h2> {# Akordiyon bölümü için genel başlık #}
                        {% for section in program.sections.all %}
                            <div class="accordion-item">
                                <button class="accordion-header">{{ section.title }}</button>
                                <div class="accordion-content">
                                    {{ section.content|safe }}
                                </div>
                            </div>
                        {% endfor %}
                        {% endif %}

                        <button class="info-button" id="how-to-register-btn-{{ program.id }}" data-program-id="{{ program.id }}">Eğitime Nasıl Kaydolacağım?</button>
                        <div class="note-box">
                            <p>Not: Kurumumuz hiçbir ticari amaç gütmemektedir. Program giderlerimiz kurumumuza yapılan bağışlarla karşılanmaktadır.</p>
                        </div>
                    </div> {# .program-accordion-details kapanışı #}

                </div> {# .program-block kapanışı #}

                {# Programlar arasına daha belirgin bir ayırıcı #}
                {% if not forloop.last %}<hr style="margin: 60px auto; width: 90%; border-top: 2px dashed #ccc;">{% endif %}

            {% endfor %} {# Program döngüsünün sonu #}
        </div> {# .all-programs-details-section kapanışı #}
    {% endif %}


    {# Modallarınız buraya eklenmeye devam ediyor, ana sayfa içeriğinin dışında olmalılar #}
    <div id="student-select-modal" class="modal-overlay" style="display: none;">
        </div>
    <div id="how-to-register-modal" class="modal-overlay" style="display: none;">
        </div>
    <div id="login-required-modal" class="modal-overlay" style="display: none;">
        </div>

{% endblock %}