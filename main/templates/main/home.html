{% extends 'base.html' %}
{% load static %}

{% block title %}Anasayfa - Eğitim Programları{% endblock %} {# Başlığı güncelleyebilirsiniz #}

{% block content %}

{# Sayfanın Genel Hoş Geldiniz veya İlk Banner Kısmı (Eğer isterseniz buraya genel bir banner koyabilirsiniz) #}
{# Şu anki HTML yapınızda bu kısım program döngüsünün içinde olduğu için tekrarlıyor. #}
{# Eğer sadece bir kez görünen genel bir başlık istiyorsanız, bu kısım dışarı taşınmalı. #}
{# Şimdilik, program yoksa bir hoş geldiniz mesajı gösterelim: #}
{% if not programs %}
    <div class="container" style="text-align: center; padding: 50px;">
        <h1>Hoş Geldiniz!</h1>
        <p>Şu anda gösterilecek aktif bir eğitim programı bulunmamaktadır. Lütfen daha sonra tekrar kontrol ediniz.</p>
    </div>
{% endif %}


{# TÜM KURSLARIN LİSTELENDİĞİ BÖLÜM #}
{# views.py'den 'all_courses' değişkenini gönderdiğinizi varsayıyoruz #}
{% if all_courses %} 
    <div class="course-list-container">
        <h2>Tüm Kurslarımız</h2> {# Genel kurs başlığı #}
        <table class="course-table">
            <thead>
                <tr>
                    <th>Yer / Saat</th>
                    <th>Sınıf Aralığı</th>
                    <th>Kontenjan</th>
                    <th>Kayıt</th>
                </tr>
            </thead>
            <tbody>
                {% for course in all_courses %} {# Tüm kurslar üzerinde döngü #}
                    <tr>
                        <td>{{ course.venue_and_time }}</td>
                        <td>{{ course.grade_range }}</td>
                        <td>{{ course.capacity }}</td>
                        <td>
                            <button class="btn-select btn-open-modal" data-course-id="{{ course.id }}">Seçiniz</button>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% endif %}

{# Her kurs tablosu ile program detayları arasına bir ayırıcı #}
{% if all_courses and programs %}<hr style="margin: 40px auto; width: 80%; border-top: 1px solid #eee;">{% endif %}


{# HER BİR PROGRAMIN AFİŞ VE DETAYLARININ LİSTELENDİĞİ BÖLÜM #}
{% if programs %} {# Eğer programlar varsa bu kısmı göster #}
    <div class="programs-list-section"> {# Tüm programları kapsayan genel bir div #}
        {% for program in programs %} {# Her bir program için döngü başlat #}

            {# === PROGRAM BAŞLIĞI VE INFO BAR KISMI (Her program için tekrarlansın) === #}
            {# Her programın kendi banner'ı ve bilgileri #}
            <div class="page-header" style="background-image: url('{% static 'img/banner.jpg' %}');">
                <h1>{{ program.title }}</h1> {# Programın başlığı #}
            </div>

            <div class="info-bar">
                <div class="info-box"><strong>Konum:</strong> {{ program.location }}</div>
                <div class="info-box">
                    <strong>Başlangıç / Bitiş:</strong>
                    {{ program.start_date|date:"d M" }} - {{ program.end_date|date:"d M Y" }}
                </div>
                <div class="info-box"><strong>Ücret:</strong> {{ program.price }} ₺</div>
            </div>

            {# AFİŞ VE AMAÇ/AKORDİYON KISMI #}
            <div class="content-area"> {# Bu div, afiş ve akordiyonu yan yana getirir #}
                <div class="details-section">
                    <div class="poster-placeholder">
                        {# Burası afişin gösterildiği yer #}
                        {% if program.poster %}
                            {# Admin panelinden yüklenen afişin URL'si #}
                            <img src="{{ program.poster.url }}" alt="{{ program.title }} Afişi" style="width: 100%; height: auto; border-radius: 8px;">
                        {% else %}
                            {# Afiş yüklenmediyse varsayılan bir görsel gösterin (static'ten) #}
                            {# Bu görseli static/img klasörünüze eklemeyi unutmayın #}
                            <img src="{% static 'img/varsayilan_program_afisi.jpg' %}" alt="Program Afişi" style="width: 100%; height: auto; border-radius: 8px;">
                        {% endif %}
                    </div>
                </div>

                <div class="accordion-section">
                    <h2>Amaç</h2> {# Başlık ekleyin #}
                    {% for section in program.sections.all %}
                        <div class="accordion-item">
                            <button class="accordion-header">{{ section.title }}</button>
                            <div class="accordion-content">
                                {{ section.content|safe }}
                            </div>
                        </div>
                    {% endfor %}

                    <button class="info-button" id="how-to-register-btn">Eğitime Nasıl Kaydolacağım?</button>

                    <div class="note-box">
                        <p>Not: Kurumumuz hiçbir ticari amaç gütmemektedir. Program giderlerimiz kurumumuza yapılan bağışlarla karşılanmaktadır.</p>
                    </div>
                </div>
            </div> {# .content-area kapanışı #}

            {# Her program bloğundan sonra bir ayırıcı ekleyebilirsiniz (son program hariç) #}
            {% if not forloop.last %}<hr style="margin: 40px auto; width: 80%; border-top: 1px solid #eee;">{% endif %}

        {% endfor %} {# Program döngüsünün sonu #}
    </div> {# .programs-list-section kapanışı #}
{% endif %}


{# Modallarınızı buraya eklemeye devam edin, bu dış döngülerin dışında olmalılar #}
<div id="student-select-modal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
        <span class="modal-close">&times;</span>
        <h3>Öğrenci Seçimi</h3>
        <p>Bu kursa kaydetmek istediğiniz öğrenciyi seçin.</p>
        <form id="add-to-cart-form">
            {% csrf_token %}
            <input type="hidden" name="course_id" id="modal-course-id">
            <select name="student_id" id="modal-student-select" required>
                <option value="">Öğrenci Seçiniz...</option>
            </select>
            <button type="submit" class="btn-submit">Sepete Ekle</button>
        </form>
    </div>
</div>

<div id="how-to-register-modal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
        <span class="modal-close how-to-register-modal-close">&times;</span>
        <h3>Eğitime Nasıl Kaydolacağım?</h3>
        <ul>
            <li>Önce sisteme veli olarak <a href="{% url 'register' %}">kayıt olun</a> ve giriş yapın.</li>
            <li>Daha sonra <a href="{% url 'student_list' %}">panelinizden</a> öğrencinizi / öğrencilerinizi sisteme ekleyin.</li>
            <li><a href="{% url 'home' %}">Eğitimler</a> sayfasında almak istediğiniz eğitimi seçin.</li>
            <li>Öğrencinize uygun seçeneği seçin ve 'Sepete Ekle' butonuna basın.</li>
            <li><a href="{% url 'cart_detail' %}">Sepetinizi</a> onaylayarak kayıt talebini tamamlayın.</li>
        </ul>
        <button class="modal-close-btn how-to-register-modal-close">Kapat</button>
    </div>
</div>

<div id="login-required-modal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
        <span class="modal-close login-required-modal-close">&times;</span>
        <h3>Giriş Gerekli</h3>
        <p>Öğrencinizi seçip kursa kaydetmek için lütfen giriş yapın veya yeni bir hesap oluşturun.</p>
        <div class="modal-actions">
            <a href="{% url 'login' %}" class="btn-submit">Giriş Yap</a>
            <a href="{% url 'register' %}">Kayıt Ol</a>
        </div>
    </div>
</div>
{% endblock %}