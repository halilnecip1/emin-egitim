{% extends 'base.html' %}
{% load static %}

{% block title %}Ödemelerim - Panelim{% endblock %}

{% block content %}
<div class="dashboard-container">
    
    <div class="dashboard-header">
        <h1>ÖDEMELERİM</h1>
    </div>

    <div class="dashboard-content">
        <div class="dashboard-nav">
            <a href="{% url 'student_list' %}" {% if request.resolver_match.url_name == 'student_list' %}class="active"{% endif %}>Öğrencilerim</a>
            <a href="#">Eğitim Takvimi</a>
            <a href="{% url 'payment_history' %}" {% if request.resolver_match.url_name == 'payment_history' %}class="active"{% endif %}>Ödemelerim</a>
            <a href="{% url 'profile_update' %}" {% if request.resolver_match.url_name == 'profile_update' %}class="active"{% endif %}>Bilgilerim</a>
            <form action="{% url 'logout' %}" method="post" class="logout-form-panel">
                {% csrf_token %}
                <button type="submit" class="logout-link">Çıkış</button>
            </form>
        </div>

        <div class="dashboard-main">
            <h3>Kayıtlarım</h3>
            {% if enrollments %}
                <table class="student-table">
                    <thead>
                        <tr>
                            <th>Öğrenci</th>
                            <th>Program</th>
                            <th>Tutar</th>
                            <th>Durum</th>
                            <th>İşlem</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for enrollment in enrollments %}
                        <tr>
                            <td>{{ enrollment.student.first_name }} {{ enrollment.student.last_name }}</td>
                            <td>{{ enrollment.course.venue_and_time }}</td>
                            <td>{{ enrollment.total_amount }} ₺</td>
                            
                            <td class="status-cell 
                                {% if enrollment.kayit_durumu == 'ODEME_BEKLENIYOR' %}status-waiting{% endif %}
                                {% if enrollment.kayit_durumu == 'ONAY_BEKLENIYOR' %}status-pending{% endif %}
                                {% if enrollment.kayit_durumu == 'KAYIT_TAMAMLANDI' %}status-approved{% endif %}
                                {% if enrollment.kayit_durumu == 'KAYIT_REDDEDILDI' %}status-rejected{% endif %}
                            ">
                                {{ enrollment.get_kayit_durumu_display }}
                            </td>
                            
                            <td>
                                {% if enrollment.kayit_durumu == 'ODEME_BEKLENIYOR' %}
                                    <button class="btn-action btn-open-receipt-modal" data-enrollment-id="{{ enrollment.id }}">Ödeme Bildir</button>
                                {% else %}
                                    -
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <p class="no-data-message">Henüz bir kurs kaydınız bulunmamaktadır.</p>
            {% endif %}
        </div>
    </div>
</div>

<div id="receipt-upload-modal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
        <span class="modal-close receipt-modal-close">&times;</span>
        <h3>Ödeme Bildirimi</h3>
        <div class="bank-info">
            <p>Lütfen aşağıdaki hesaba ödemeyi yaparken açıklama kısmına <strong>öğrencinin adını ve soyadını</strong> yazdığınızdan emin olunuz.</p>
            <p><strong>Alıcı:</strong> EMİN EĞİTİM DERNEĞİ</p>
            <p><strong>IBAN:</strong> TR35 0020 5000 0080 3259 9000 01</p>
            <p><strong>Banka:</strong> KUVEYT TÜRK</p>
        </div>
        <hr>
        <p>Ödemeyi yaptıktan sonra dekontu aşağıdan yükleyebilirsiniz.</p>
        <form id="receipt-upload-form" method="post" enctype="multipart/form-data">
            {% csrf_token %}
            <input type="file" name="dekont" required style="width: 100%; margin-bottom: 20px;">
            <button type="submit" class="btn-submit">Dekontu Yükle ve Bildir</button>
        </form>
    </div>
</div>
{% endblock %}